# Clawdbot开关机指南

## 🎯 **文档目的**
为Clawdbot（MOSS助手）的安全开关机提供标准化操作流程，确保系统稳定和数据安全。

## 📅 **创建时间**
2026年1月30日

## 🏠 **适用场景**
1. 日常使用后的关机
2. 携带电脑移动前的关机
3. 长时间不使用的关机
4. 系统维护或重启

## 🔧 **安全关机流程**

### **方案A：优雅关机（推荐）**
```bash
# 1. 停止Clawdbot网关服务
clawdbot gateway stop

# 2. 等待3-5秒确保服务完全停止
sleep 5

# 3. 正常关闭电脑
# - 点击系统菜单 → 关机
# - 或使用快捷键
```

### **方案B：直接关机（简化）**
```bash
# 直接关机，Clawdbot会自动检测关机信号并优雅关闭
# 系统会自动处理关闭流程
```

### **方案C：紧急关机**
```bash
# 如果遇到问题需要强制关机
# 1. 先尝试正常关机流程
# 2. 如果不行，直接系统关机
# 3. Clawdbot会在下次启动时自动恢复
```

## 🚀 **安全开机流程**

### **标准开机流程**
```bash
# 1. 正常启动电脑
# 2. 等待系统完全启动（约30秒）
# 3. 启动Clawdbot网关
clawdbot gateway start

# 4. 等待启动完成（约10-15秒）
sleep 15

# 5. 检查状态
clawdbot status

# 6. 继续工作
```

### **快速检查命令**
```bash
# 检查网关是否运行
ps aux | grep clawdbot-gateway | grep -v grep

# 检查端口监听
lsof -i :18789

# 查看日志
tail -f ~/.clawdbot/logs/gateway.log
```

## 📊 **状态验证**

### **开机后验证项目**
1. ✅ **网关状态**：`clawdbot status` 显示正常
2. ✅ **端口监听**：18789端口可访问
3. ✅ **控制面板**：http://127.0.0.1:18789/ 可访问
4. ✅ **会话恢复**：之前的对话上下文完整
5. ✅ **系统功能**：所有工具和技能正常

### **常见状态信息**
```
正常状态：
- Gateway: reachable
- Channels: 正常显示已配置的通道
- Sessions: 显示活跃会话
- Agents: 显示代理状态
```

## 🔄 **数据安全保证**

### **关机时自动保存**
Clawdbot会在关机时自动：
1. ✅ **保存会话状态**：对话上下文和记忆
2. ✅ **提交Git更改**：如果有未提交的代码变更
3. ✅ **清理临时文件**：释放磁盘空间
4. ✅ **记录关闭日志**：便于问题排查

### **开机时自动恢复**
Clawdbot会在开机时自动：
1. ✅ **恢复会话**：继续之前的对话
2. ✅ **加载配置**：所有设置和偏好
3. ✅ **启动服务**：网关和所有插件
4. ✅ **检查系统**：确保一切正常

## 💡 **最佳实践**

### **日常使用建议**
1. **每日结束**：使用优雅关机流程
2. **短期离开**：无需关机，Clawdbot会低功耗运行
3. **携带移动**：务必先关机再移动电脑
4. **长期不用**：优雅关机，数据已安全保存

### **问题处理**
```bash
# 如果开机后Clawdbot未启动
clawdbot gateway start

# 如果启动失败
clawdbot doctor --fix

# 查看详细日志
tail -100 ~/.clawdbot/logs/gateway.log

# 完全重启
clawdbot gateway stop
sleep 5
clawdbot gateway start
```

### **备份提醒**
虽然Clawdbot会自动保存，但建议：
1. **定期Git提交**：重要代码及时推送到GitHub
2. **文档备份**：重要文档多位置保存
3. **配置备份**：备份 `~/.clawdbot/clawdbot.json`

## 🛡️ **安全注意事项**

### **关机前检查**
1. ✅ **重要工作已保存**：代码、文档、配置
2. ✅ **无正在运行的任务**：长时间任务已完成
3. ✅ **网络操作已结束**：下载、上传已完成
4. ✅ **外部设备已安全移除**：U盘、外接硬盘

### **开机后检查**
1. ✅ **网络连接正常**：确保在线功能可用
2. ✅ **磁盘空间充足**：至少1GB可用空间
3. ✅ **系统时间正确**：影响证书和API调用
4. ✅ **权限正常**：文件读写权限正常

## 📱 **移动场景特别指南**

### **携带电脑回家/外出**
```bash
# 1. 保存所有工作
git add . && git commit -m "下班保存" && git push

# 2. 优雅关闭Clawdbot
clawdbot gateway stop
sleep 3

# 3. 系统关机
# 4. 安全携带电脑
# 5. 到达后开机继续
```

### **跨网络环境**
```bash
# 如果网络环境变化（如从公司到家庭）
# Clawdbot会自动适应，但可能需要：
1. 检查网络连接
2. 验证API密钥可用性
3. 测试外部服务访问
```

## 🔧 **故障排除**

### **开机后常见问题**

#### **问题1：Clawdbot未自动启动**
```bash
# 手动启动
clawdbot gateway start

# 检查启动日志
tail -f ~/.clawdbot/logs/gateway.log
```

#### **问题2：端口被占用**
```bash
# 检查端口占用
lsof -i :18789

# 如果被占用，可以：
# 1. 停止占用进程
# 2. 或修改Clawdbot端口
clawdbot config set gateway.port 18790
clawdbot gateway restart
```

#### **问题3：会话未恢复**
```bash
# 检查会话文件
ls -la ~/.clawdbot/agents/main/sessions/

# 如果会话文件损坏
clawdbot doctor --fix
```

## 📝 **使用记录**

### **2026-01-30 首次创建**
- 基于实际使用经验整理
- 包含优雅关机和安全开机流程
- 涵盖各种使用场景
- 加入故障排除指南

### **更新计划**
1. 根据实际使用反馈更新
2. 添加新功能的使用指南
3. 优化流程提高效率
4. 定期回顾和修订

---

## 💬 **最后提醒**

### **记住：**
1. **优雅关机**保护数据安全
2. **定期备份**防止意外丢失
3. **及时更新**获得最新功能
4. **反馈改进**让系统更好用

### **需要帮助时：**
1. 查看本指南
2. 检查日志文件
3. 运行诊断命令
4. 联系技术支持

**祝你使用愉快！** 🚀